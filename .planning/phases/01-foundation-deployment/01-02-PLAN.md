---
phase: 01-foundation-deployment
plan: 02
type: execute
wave: 2
depends_on: ["01-01"]
files_modified:
  - .github/workflows/deploy.yml
autonomous: false

user_setup:
  - service: github-pages
    why: "Static site hosting"
    dashboard_config:
      - task: "Enable GitHub Pages with GitHub Actions source"
        location: "Repository Settings > Pages > Source > GitHub Actions"

must_haves:
  truths:
    - "Pushing to main triggers the GitHub Actions workflow"
    - "The workflow builds and deploys without manual intervention"
    - "The test article is accessible at its thematic URL on the live site"
  artifacts:
    - path: ".github/workflows/deploy.yml"
      provides: "GitHub Actions deployment workflow"
      contains: "actions/deploy-pages"
  key_links:
    - from: ".github/workflows/deploy.yml"
      to: "package.json"
      via: "npm ci and eleventy build commands"
      pattern: "npm ci"
    - from: ".github/workflows/deploy.yml"
      to: "_site/"
      via: "upload-pages-artifact path"
      pattern: "path.*_site"
---

<objective>
Create the GitHub Actions workflow for automatic deployment to GitHub Pages and verify the full pipeline works end-to-end.

Purpose: Complete the deployment infrastructure so that pushing to main automatically publishes the site. This proves the entire foundation works before adding real content.
Output: A live GitHub Pages site accessible at https://{username}.github.io/learn-mech-interp/ with the test article at /topics/test/.
</objective>

<execution_context>
@/Users/ivan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ivan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation-deployment/01-RESEARCH.md
@.planning/phases/01-foundation-deployment/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create GitHub Actions deployment workflow</name>
  <files>
    .github/workflows/deploy.yml
  </files>
  <action>
Create .github/workflows/deploy.yml with the official GitHub Pages workflow:

1. Triggers:
   - push to main branch
   - workflow_dispatch (manual trigger)

2. Permissions:
   - contents: read
   - pages: write
   - id-token: write

3. Concurrency:
   - group: "pages"
   - cancel-in-progress: false

4. Build job:
   - runs-on: ubuntu-latest
   - Checkout with actions/checkout@v5
   - Setup Node.js 20 with actions/setup-node@v4, cache npm
   - Run `npm ci` to install dependencies
   - Run `npx @11ty/eleventy` to build
   - Upload artifact with actions/upload-pages-artifact@v4, path: _site

5. Deploy job:
   - needs: build
   - runs-on: ubuntu-latest
   - environment: name: github-pages, url from deployment output
   - Deploy with actions/deploy-pages@v4

Use exact versions: checkout@v5, setup-node@v4, upload-pages-artifact@v4, deploy-pages@v4 (per research - older versions deprecated).
  </action>
  <verify>
Verify workflow file:
- `cat .github/workflows/deploy.yml` shows correct structure
- YAML is valid (no syntax errors)
- All action versions are v4+ (not v3)
  </verify>
  <done>
GitHub Actions workflow file exists at .github/workflows/deploy.yml with correct triggers, permissions, and job structure using official GitHub Pages actions.
  </done>
</task>

<task type="auto">
  <name>Task 2: Commit and push to trigger deployment</name>
  <files></files>
  <action>
1. Stage all new and modified files:
   - package.json, package-lock.json
   - eleventy.config.js
   - src/_includes/layouts/base.njk
   - src/index.njk
   - src/topics/topics.11tydata.js
   - src/topics/test/index.md
   - .github/workflows/deploy.yml
   - .gitignore

2. Create commit with message:
   "feat(01): foundation and deployment infrastructure

   - Initialize Eleventy 3.x with ESM configuration
   - Add base Nunjucks layout template
   - Create thematic /topics/ folder structure with directory data
   - Add test article at /topics/test/
   - Configure GitHub Actions for automatic deployment to Pages

   Requirements: INFR-01, INFR-02, INFR-04, INFR-05"

3. Push to main branch to trigger deployment

Note: If the user hasn't enabled GitHub Pages yet, the deploy job will fail. This is expected and will be addressed in the checkpoint.
  </action>
  <verify>
- `git status` shows clean working directory after commit
- `git log -1` shows the commit with expected message
- `git push` succeeds (or reports workflow will run)
  </verify>
  <done>
All Phase 1 files are committed and pushed to main. The GitHub Actions workflow has been triggered.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete Eleventy site with GitHub Actions deployment pipeline. The workflow should build the site and deploy to GitHub Pages automatically.
  </what-built>
  <how-to-verify>
1. **If GitHub Pages not yet enabled:**
   - Go to repository Settings > Pages
   - Under "Source", select "GitHub Actions"
   - The workflow will automatically re-run or you can trigger manually

2. **Check workflow status:**
   - Go to repository Actions tab
   - Look for "Deploy to GitHub Pages" workflow
   - Verify both "build" and "deploy" jobs show green checkmarks

3. **Verify live site:**
   - Visit https://{your-username}.github.io/learn-mech-interp/
   - Homepage should show "Learn Mechanistic Interpretability"
   - Click link to test article (or visit /topics/test/ directly)
   - Test article should display with title and content

4. **Verify thematic URL:**
   - The test article URL should be: https://{your-username}.github.io/learn-mech-interp/topics/test/
   - NOT /topics/test/index.html or any other variation

**Expected results:**
- Workflow completes in ~1-2 minutes
- Site loads without 404 errors
- Test article accessible at thematic URL
- No broken CSS/JS (minimal styling is expected at this phase)
  </how-to-verify>
  <resume-signal>Type "deployed" if the site is live and working, or describe any issues encountered.</resume-signal>
</task>

</tasks>

<verification>
Phase 1 is complete when all success criteria from ROADMAP.md are met:

1. Running the build command produces a fully static `_site/` directory with valid HTML, CSS, and JS files
   - Verified in Plan 01

2. Pushing to main triggers a GitHub Actions workflow that deploys the site to GitHub Pages without manual intervention
   - Workflow file exists and triggers on push to main
   - After Pages enabled, deployment is automatic

3. A test article is accessible at its thematic URL path (e.g., `/topics/test/`) on the live GitHub Pages site
   - User verifies in checkpoint

4. The thematic folder structure exists and new content files placed in `/topics/<name>/` automatically build to the correct output path
   - Directory data file handles this automatically
</verification>

<success_criteria>
- INFR-01: Site builds to fully static HTML/CSS/JS deployable on GitHub Pages - VERIFIED by live deployment
- INFR-02: Eleventy with Nunjucks templating - VERIFIED by successful build
- INFR-04: Thematic folder structure - VERIFIED by /topics/test/ URL working
- INFR-05: GitHub Actions CI/CD pipeline - VERIFIED by automatic deployment on push
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-deployment/01-02-SUMMARY.md`
</output>
