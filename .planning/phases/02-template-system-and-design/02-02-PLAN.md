---
phase: 02-template-system-and-design
plan: 02
type: execute
wave: 2
depends_on: ["02-01"]
files_modified:
  - src/_includes/layouts/base.njk
  - src/_includes/layouts/article.njk
  - src/_includes/partials/header.njk
  - src/_includes/partials/footer.njk
  - src/topics/topics.11tydata.js
  - src/topics/test/index.md
  - src/index.njk
autonomous: false

must_haves:
  truths:
    - "Changing header.njk or footer.njk propagates to all pages"
    - "Articles render with readable font at ~18px and 60-75 character line width"
    - "Site layout works on 320px mobile without horizontal scrolling"
    - "Site layout works on 1200px desktop with proper spacing"
    - "All pages use semantic HTML (article, nav, main, section, proper heading hierarchy)"
  artifacts:
    - path: "src/_includes/layouts/base.njk"
      provides: "HTML5 document structure with CSS links and partials"
      contains: "include \"partials/header.njk\""
    - path: "src/_includes/layouts/article.njk"
      provides: "Article-specific layout extending base"
      contains: "layout: layouts/base.njk"
    - path: "src/_includes/partials/header.njk"
      provides: "Shared site header"
      contains: "site-header"
    - path: "src/_includes/partials/footer.njk"
      provides: "Shared site footer"
      contains: "site-footer"
    - path: "src/topics/topics.11tydata.js"
      provides: "Article layout assignment for topics"
      contains: "layouts/article.njk"
  key_links:
    - from: "src/_includes/layouts/base.njk"
      to: "/css/variables.css"
      via: "stylesheet link"
      pattern: "href=\"/css/variables.css\""
    - from: "src/_includes/layouts/article.njk"
      to: "src/_includes/layouts/base.njk"
      via: "Eleventy layout chaining"
      pattern: "layout: layouts/base.njk"
    - from: "src/topics/topics.11tydata.js"
      to: "src/_includes/layouts/article.njk"
      via: "directory data file"
      pattern: "layouts/article.njk"
---

<objective>
Build the three-layer template system with shared header/footer partials and verify responsive design across mobile and desktop.

Purpose: Complete the DRY template system so adding new articles requires only a Markdown file with front matter, and enable propagation of header/footer changes to all pages.
Output: Updated layouts (base.njk, article.njk), new partials (header.njk, footer.njk), and visual verification of responsive design.
</objective>

<execution_context>
@/Users/ivan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ivan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-template-system-and-design/02-RESEARCH.md
@.planning/phases/02-template-system-and-design/02-01-SUMMARY.md

# Current files
@src/_includes/layouts/base.njk
@src/topics/topics.11tydata.js
@src/topics/test/index.md
@src/index.njk
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create partials and update base layout</name>
  <files>
    src/_includes/partials/header.njk
    src/_includes/partials/footer.njk
    src/_includes/layouts/base.njk
  </files>
  <action>
Create src/_includes/partials/ directory and two partial files:

**header.njk** - Site header with semantic markup:
```nunjucks
<header class="site-header">
  <nav class="site-nav" aria-label="Main navigation">
    <a href="/" class="site-logo">Learn MI</a>
    <ul class="nav-links">
      <li><a href="/topics/">Topics</a></li>
    </ul>
  </nav>
</header>
```

**footer.njk** - Site footer:
```nunjucks
<footer class="site-footer">
  <p>Learn Mechanistic Interpretability</p>
</footer>
```

**base.njk** - Complete rewrite to:
- Remove inline styles
- Add meta description using description variable with default fallback
- Link all four CSS files: /css/variables.css, /css/base.css, /css/layout.css, /css/components.css
- Include header.njk partial before main
- Include footer.njk partial after main
- Keep semantic structure: header (with nav), main (with content), footer

Use this structure:
```nunjucks
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% if title %}{{ title }} | {% endif %}Learn Mechanistic Interpretability</title>
  <meta name="description" content="{{ description | default('Learn Mechanistic Interpretability through structured articles covering transformer internals to frontier research.') }}">
  <link rel="stylesheet" href="/css/variables.css">
  <link rel="stylesheet" href="/css/base.css">
  <link rel="stylesheet" href="/css/layout.css">
  <link rel="stylesheet" href="/css/components.css">
</head>
<body>
  {% include "partials/header.njk" %}
  <main>
    {{ content | safe }}
  </main>
  {% include "partials/footer.njk" %}
</body>
</html>
```
  </action>
  <verify>
Files exist: ls src/_includes/partials/header.njk src/_includes/partials/footer.njk
Base uses partials: grep "include.*partials" src/_includes/layouts/base.njk
CSS linked: grep 'href="/css/' src/_includes/layouts/base.njk shows 4 stylesheets
Build succeeds: npm run build
  </verify>
  <done>
header.njk and footer.njk contain semantic markup.
base.njk includes both partials and links all CSS files.
Build succeeds with updated templates.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create article layout and update content files</name>
  <files>
    src/_includes/layouts/article.njk
    src/topics/topics.11tydata.js
    src/topics/test/index.md
    src/index.njk
  </files>
  <action>
**article.njk** - Article layout extending base:
```nunjucks
---
layout: layouts/base.njk
---
<article class="article">
  <header class="article-header">
    <h1 class="article-title">{{ title }}</h1>
    {% if description %}
    <p class="article-description">{{ description }}</p>
    {% endif %}
  </header>
  <div class="article-body">
    {{ content | safe }}
  </div>
</article>
```

**topics.11tydata.js** - Update to use article layout:
```javascript
export default {
  layout: "layouts/article.njk",
  permalink: "/topics/{{ page.fileSlug }}/"
};
```

**test/index.md** - Update front matter with description, keep content but remove the h1 (now rendered by article layout):
```markdown
---
title: Test Article
description: A minimal test article to verify the build and deployment pipeline
---

This is a test article to verify:

1. The Eleventy build completes successfully
2. The GitHub Actions workflow deploys to GitHub Pages
3. The thematic URL structure works (/topics/test/)

If you can read this on the live site, the foundation phase is complete.
```

**index.njk** - Update to use container class and semantic structure:
```nunjucks
---
title: Home
layout: layouts/base.njk
---
<div class="container">
  <h1>Learn Mechanistic Interpretability</h1>
  <p>A static website for learning Mechanistic Interpretability through well-structured articles covering transformer internals to frontier research.</p>
  <h2>Getting Started</h2>
  <p>Browse the <a href="/topics/">Topics</a> to begin learning, or start with the <a href="/topics/test/">Test Article</a>.</p>
</div>
```
  </action>
  <verify>
Article layout exists: ls src/_includes/layouts/article.njk
Layout chaining: grep "layout: layouts/base.njk" src/_includes/layouts/article.njk
Topics use article: grep "article.njk" src/topics/topics.11tydata.js
Build succeeds: npm run build
Article renders: grep -l "article-body" _site/topics/test/index.html
  </verify>
  <done>
article.njk provides article-specific structure extending base.njk.
Topics directory data file uses article layout.
Test article renders with article layout wrapper.
Homepage uses container class and semantic structure.
  </done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete template system with CSS design system:
- Four CSS files with custom properties and responsive styles
- Base layout with header/footer partials
- Article layout for topic content
- Updated homepage and test article
  </what-built>
  <how-to-verify>
1. Run `npm start` to start the dev server (typically http://localhost:8080)
2. Visit the homepage:
   - Header should show "Learn MI" logo and "Topics" link
   - Content should be centered with readable width (~65 characters)
   - Footer should appear at bottom
3. Click "Test Article" or navigate to /topics/test/:
   - Title and description should appear in article header
   - Body content should have readable typography (~18px, good line height)
   - Article body should be constrained to ~65 characters width
4. Test responsive behavior:
   - Resize browser to 320px width (mobile): No horizontal scrolling, content readable
   - Resize to 1200px+ (desktop): Content centered with appropriate margins
5. Verify header/footer propagation:
   - Confirm header appears on both homepage and article
   - Confirm footer appears on both pages
  </how-to-verify>
  <resume-signal>Type "approved" if design meets requirements, or describe issues to fix</resume-signal>
</task>

</tasks>

<verification>
After all tasks complete and checkpoint approved:
1. npm run build succeeds
2. Header appears on all pages (check homepage and article)
3. Footer appears on all pages
4. Article has proper semantic structure (article > header > h1, article > div.article-body)
5. Content width is constrained to readable line length
6. Site works on mobile (320px) and desktop (1200px)
</verification>

<success_criteria>
- Changing header.njk or footer.njk updates all pages (single source of truth)
- Articles render with clean academic typography at ~18px with 60-75 character line width
- Site layout works on 320px mobile without horizontal scrolling
- Site layout works on 1200px desktop with centered content
- All pages use semantic HTML (article, nav, main, proper heading hierarchy)
- Adding new articles requires only a Markdown file with front matter in /topics/
</success_criteria>

<output>
After completion, create `.planning/phases/02-template-system-and-design/02-02-SUMMARY.md`
</output>
