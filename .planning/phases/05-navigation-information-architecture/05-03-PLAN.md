---
phase: 05-navigation-information-architecture
plan: 03
type: execute
wave: 3
depends_on: ["05-02"]
files_modified:
  - src/_includes/layouts/article.njk
  - src/css/components.css
autonomous: true

must_haves:
  truths:
    - "Each article shows breadcrumbs (Home > Block Title > Article Title) with the current page indicated"
    - "Each article shows previous/next links at the bottom following learning path order"
    - "Each article has an auto-generated table of contents from h2/h3 headings, fixed on wide screens"
    - "Each article displays a difficulty badge (Foundational / Intermediate / Advanced) with color coding"
    - "Each article with prerequisites shows 'Read first:' label with linked article titles"
  artifacts:
    - path: "src/_includes/layouts/article.njk"
      provides: "Article layout with breadcrumbs, TOC, prev/next, difficulty badge, prerequisites"
      contains: "breadcrumbs"
    - path: "src/css/components.css"
      provides: "Styles for breadcrumbs, TOC, prev/next, difficulty badge"
      contains: "difficulty-badge"
  key_links:
    - from: "src/_includes/layouts/article.njk"
      to: "eleventy.config.js"
      via: "TOC filter from eleventy-plugin-toc, getPreviousCollectionItem/getNextCollectionItem filters"
      pattern: "toc|getPreviousCollectionItem"
    - from: "src/_includes/layouts/article.njk"
      to: "src/_data/learningPath.json"
      via: "learningPath global data for breadcrumb block title lookup"
      pattern: "learningPath"
---

<objective>
Add breadcrumbs, table of contents, previous/next article links, difficulty badges, and enhanced prerequisite indicators to the article layout.

Purpose: Readers can orient themselves (breadcrumbs), navigate sequentially (prev/next), scan the article structure (TOC), and understand article difficulty and prerequisites at a glance.
Output: Complete article navigation with breadcrumbs, sticky TOC, prev/next links, difficulty badge, and "Read first" prerequisite labels.
</objective>

<execution_context>
@/Users/ivan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ivan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-navigation-information-architecture/05-RESEARCH.md
@.planning/phases/05-navigation-information-architecture/05-01-SUMMARY.md
@.planning/phases/05-navigation-information-architecture/05-02-SUMMARY.md
@src/_includes/layouts/article.njk
@src/css/components.css
@src/css/layout.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update article layout with breadcrumbs, TOC, difficulty, prerequisites, and prev/next</name>
  <files>src/_includes/layouts/article.njk</files>
  <action>
    Rewrite `src/_includes/layouts/article.njk` to include all navigation elements. The layout extends base.njk (unchanged). The new structure:

    ```nunjucks
    ---
    layout: layouts/base.njk
    ---
    {# Breadcrumbs: Home > Block Title > Current Article #}
    {% set blockTitle = null %}
    {% for block in learningPath.blocks %}
      {% if block.slug == block_name %}
        {% set blockTitle = block.title %}
      {% endif %}
    {% endfor %}
    <nav class="breadcrumbs" aria-label="Breadcrumb">
      <ol>
        <li><a href="/">Home</a></li>
        {% if blockTitle %}
          <li>{{ blockTitle }}</li>
        {% endif %}
        <li aria-current="page">{{ title }}</li>
      </ol>
    </nav>

    <article class="article">
      <header class="article-header">
        {% if difficulty %}
          <span class="difficulty-badge difficulty-{{ difficulty }}">{{ difficulty | capitalize }}</span>
        {% endif %}
        <h1 class="article-title">{{ title }}</h1>
        {% if description %}
        <p class="article-description">{{ description }}</p>
        {% endif %}
        {% if prerequisites and prerequisites.length %}
        <div class="article-prerequisites">
          <span class="prerequisites-label">Read first:</span>
          {% for prereq in prerequisites %}{% if loop.index > 1 %}, {% endif %}<a href="{{ prereq.url }}">{{ prereq.title }}</a>{% endfor %}
        </div>
        {% endif %}
      </header>

      <div class="article-content-wrapper">
        <aside class="article-toc" aria-label="Table of contents">
          <h2 class="toc-heading">Contents</h2>
          {{ content | toc | safe }}
        </aside>

        <div class="article-body">
          {{ content | safe }}
        </div>
      </div>
    </article>

    {# Previous/Next navigation #}
    {% set prevArticle = collections.learningPath | getPreviousCollectionItem(page) %}
    {% set nextArticle = collections.learningPath | getNextCollectionItem(page) %}
    {% if prevArticle or nextArticle %}
    <nav class="article-nav" aria-label="Article navigation">
      {% if prevArticle %}
        <a href="{{ prevArticle.url }}" class="article-nav-link article-nav-prev">
          <span class="article-nav-label">Previous</span>
          <span class="article-nav-title">{{ prevArticle.data.title }}</span>
        </a>
      {% endif %}
      {% if nextArticle %}
        <a href="{{ nextArticle.url }}" class="article-nav-link article-nav-next">
          <span class="article-nav-label">Next</span>
          <span class="article-nav-title">{{ nextArticle.data.title }}</span>
        </a>
      {% endif %}
    </nav>
    {% endif %}
    ```

    IMPORTANT NOTES:
    - The `block_name` variable for breadcrumbs must reference the front matter `block` field. In Nunjucks templates, front matter fields are available as top-level variables. The field is named `block` in front matter but we cannot use `block` as a Nunjucks variable name because it conflicts with the Nunjucks `block` keyword. To work around this, use `eleventyNavigation.parent` instead (which was set to `data.block` in the computed data from Plan 01):

    Instead of the breadcrumb block shown above, use this approach:

    ```nunjucks
    {% set blockSlug = eleventyNavigation.parent if eleventyNavigation else null %}
    {% set blockTitle = null %}
    {% if blockSlug %}
      {% for b in learningPath.blocks %}
        {% if b.slug == blockSlug %}
          {% set blockTitle = b.title %}
        {% endif %}
      {% endfor %}
    {% endif %}
    ```

    - The `toc` filter comes from eleventy-plugin-toc (registered in Plan 01). It generates an HTML `<ul>` list from h2/h3 headings in the rendered content.
    - The `getPreviousCollectionItem` and `getNextCollectionItem` are built-in Eleventy filters that work on any collection. They use `page` to find the current item in the collection.
    - The existing `<p class="article-prerequisites">` is replaced with a `<div>` containing a "Read first:" label, which is a more explicit indicator than the previous "Prerequisites:" text.
  </action>
  <verify>
    - `npx @11ty/eleventy` builds without errors
    - Built attention-mechanism article contains breadcrumbs with "Transformer Foundations"
    - Built superposition article contains difficulty badge with "Intermediate"
    - Built superposition article contains "Read first:" with link to attention mechanism
    - Built activation-patching article contains prev/next links
    - Built articles contain a TOC with h2/h3 headings listed
  </verify>
  <done>Article layout renders breadcrumbs, difficulty badge, enhanced prerequisites, TOC, and prev/next links. All 3 pilot articles render correctly with their specific metadata.</done>
</task>

<task type="auto">
  <name>Task 2: CSS for breadcrumbs, TOC, prev/next, and difficulty badges</name>
  <files>src/css/components.css</files>
  <action>
    Add the following CSS sections to `src/css/components.css` at the end of the file:

    **Breadcrumbs:**

    ```css
    /* ==========================================================================
       BREADCRUMBS
       Home > Block > Article navigation path.
       ========================================================================== */

    .breadcrumbs {
      max-width: var(--content-width-wide, 80ch);
      margin: 0 auto;
      padding: var(--spacing-sm, 0.5rem) var(--container-padding, 1.5rem);
    }

    .breadcrumbs ol {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-wrap: wrap;
      gap: 0.25rem;
      font-size: var(--font-size-small, 0.875rem);
      color: var(--color-text-muted, rgba(0, 0, 0, 0.4));
    }

    .breadcrumbs li:not(:last-child)::after {
      content: ">";
      margin-left: 0.25rem;
      color: var(--color-text-muted, rgba(0, 0, 0, 0.3));
    }

    .breadcrumbs a {
      color: var(--color-text-secondary, rgba(0, 0, 0, 0.6));
      text-decoration: none;
    }

    .breadcrumbs a:hover {
      color: var(--color-link, #004276);
    }

    .breadcrumbs [aria-current="page"] {
      color: var(--color-text, rgba(0, 0, 0, 0.87));
    }
    ```

    **Difficulty Badges:**

    ```css
    /* ==========================================================================
       DIFFICULTY BADGES
       Color-coded indicators for article difficulty level.
       ========================================================================== */

    .difficulty-badge {
      display: inline-block;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      padding: 0.2em 0.6em;
      border-radius: 3px;
      margin-bottom: var(--spacing-sm, 0.5rem);
    }

    .difficulty-foundational {
      background: #e8f5e9;
      color: #2e7d32;
    }

    .difficulty-intermediate {
      background: #fff3e0;
      color: #e65100;
    }

    .difficulty-advanced {
      background: #fce4ec;
      color: #c62828;
    }
    ```

    **Enhanced Prerequisites:**

    Update the existing `.article-prerequisites` styles to accommodate the new "Read first:" label:

    ```css
    /* Article Prerequisites - enhanced with "Read first:" label */
    .prerequisites-label {
      font-weight: 600;
      color: var(--color-text-secondary, rgba(0, 0, 0, 0.6));
    }
    ```

    Note: Keep the existing `.article-prerequisites` rules (font-size, color, margin) -- just add the `.prerequisites-label` class.

    **Table of Contents:**

    ```css
    /* ==========================================================================
       TABLE OF CONTENTS
       Auto-generated from h2/h3 headings. Hidden on mobile, sticky on wide screens.
       ========================================================================== */

    .article-content-wrapper {
      position: relative;
    }

    .article-toc {
      display: none;
    }

    .toc-heading {
      font-size: var(--font-size-small, 0.875rem);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--color-text-muted, rgba(0, 0, 0, 0.4));
      margin: 0 0 var(--spacing-sm, 0.5rem) 0;
    }

    .article-toc ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .article-toc li {
      margin-bottom: 0.25rem;
    }

    .article-toc a {
      font-size: var(--font-size-small, 0.875rem);
      color: var(--color-text-secondary, rgba(0, 0, 0, 0.6));
      text-decoration: none;
      display: block;
      padding: 0.125rem 0;
      transition: color var(--transition-fast, 150ms ease);
    }

    .article-toc a:hover {
      color: var(--color-link, #004276);
    }

    /* Nested TOC items (h3) are indented */
    .article-toc ul ul {
      padding-left: var(--spacing-md, 1rem);
    }

    /* Show TOC on wide screens, positioned in right margin */
    @media (min-width: 1400px) {
      .article-content-wrapper {
        display: grid;
        grid-template-columns: minmax(auto, var(--content-width, 65ch)) 220px;
        gap: var(--spacing-xl, 2rem);
        align-items: start;
      }

      .article-toc {
        display: block;
        position: sticky;
        top: var(--spacing-xl, 2rem);
        max-height: calc(100vh - 4rem);
        overflow-y: auto;
      }
    }
    ```

    IMPORTANT: The TOC grid at 1400px+ creates a 2-column layout within the article body area. This replaces the current approach where sidenotes float into a right margin. The existing `@media (min-width: 1400px)` block in layout.css for the article grid should still work because the `.article` grid handles the overall article placement, and this `.article-content-wrapper` grid handles the TOC positioning within the article body area.

    However, sidenotes currently use `float: right; margin-right: -60%` to escape into the right margin. With the TOC now occupying the right column at 1400px+, the sidenotes and TOC could conflict. To handle this, the sidenotes should float within the article-body column (the first column of the content-wrapper grid), and the TOC sits in its own column. The existing sidenote float CSS in layout.css at 1400px+ targets `.sidenote, .marginnote` -- these elements live inside `.article-body` (the first column), so they should float within that column. Adjust the sidenote `margin-right` at 1400px+ if needed:

    In `src/css/layout.css`, if the article-content-wrapper grid is introduced, the sidenotes at 1400px+ may need reduced margin. But first, test whether the existing float behavior works. If sidenotes overflow into the TOC column, reduce `margin-right: -60%` to a smaller value. For now, leave the existing layout.css 1400px+ rules as-is and test.

    **Previous/Next Navigation:**

    ```css
    /* ==========================================================================
       PREVIOUS/NEXT ARTICLE NAVIGATION
       Sequential navigation links at the bottom of articles.
       ========================================================================== */

    .article-nav {
      max-width: var(--content-width-wide, 80ch);
      margin: var(--spacing-2xl, 3rem) auto;
      padding: 0 var(--container-padding, 1.5rem);
      display: flex;
      justify-content: space-between;
      gap: var(--spacing-md, 1rem);
    }

    .article-nav-link {
      display: flex;
      flex-direction: column;
      text-decoration: none;
      padding: var(--spacing-md, 1rem);
      border: 1px solid var(--color-border, rgba(0, 0, 0, 0.1));
      border-radius: var(--radius-lg, 8px);
      transition: border-color var(--transition-fast, 150ms ease);
      flex: 1;
      max-width: 48%;
    }

    .article-nav-link:hover {
      border-color: var(--color-link, #004276);
    }

    .article-nav-prev {
      align-items: flex-start;
    }

    .article-nav-next {
      align-items: flex-end;
      margin-left: auto;
    }

    .article-nav-label {
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--color-text-muted, rgba(0, 0, 0, 0.4));
      margin-bottom: 0.25rem;
    }

    .article-nav-title {
      font-size: var(--font-size-small, 0.875rem);
      color: var(--color-link, #004276);
      font-weight: 500;
    }

    @media (max-width: 480px) {
      .article-nav {
        flex-direction: column;
      }

      .article-nav-link {
        max-width: 100%;
      }

      .article-nav-next {
        align-items: flex-start;
      }
    }
    ```

    The breadcrumbs max-width should match the article max-width. On tablet+ the article padding is 0, so breadcrumbs should also have minimal padding:

    ```css
    @media (min-width: 768px) {
      .breadcrumbs {
        padding-left: 0;
        padding-right: 0;
      }
    }
    ```
  </action>
  <verify>
    - `npx @11ty/eleventy` builds without errors
    - Inspect built CSS to confirm breadcrumbs, difficulty badge, TOC, and article-nav styles are present
    - Visually confirm (or grep) that the `.difficulty-foundational`, `.difficulty-intermediate`, `.difficulty-advanced` classes exist in the CSS output
  </verify>
  <done>CSS for breadcrumbs, difficulty badges, TOC (hidden on mobile, sticky on wide), prev/next navigation, and enhanced prerequisites is added. All styles use existing CSS custom properties for consistency.</done>
</task>

</tasks>

<verification>
1. `npx @11ty/eleventy` builds without errors
2. Attention mechanism article: breadcrumbs show "Home > Transformer Foundations", difficulty badge shows "Foundational" in green, no prerequisites section
3. Superposition article: breadcrumbs show "Home > Superposition & Feature Extraction", difficulty badge shows "Intermediate" in orange, "Read first:" with link to attention mechanism
4. Activation patching article: breadcrumbs show "Home > Observation to Causation", difficulty badge shows "Advanced" in red, prev/next links present
5. All articles contain a TOC listing their h2/h3 headings
6. TOC is hidden on screens < 1400px, visible and sticky on 1400px+
7. Prev/next navigation shows correct order: Attention Mechanism -> Superposition -> Activation Patching
8. No regressions in existing content rendering (KaTeX, citations, sidenotes, figures)
</verification>

<success_criteria>
- Breadcrumbs render on all articles with correct block title from learningPath data
- Difficulty badges display with correct color coding for all 3 difficulty levels
- Prerequisites show "Read first:" label instead of plain "Prerequisites:"
- TOC auto-generates from h2/h3 headings and is sticky on wide screens
- Prev/next links follow learningPath.json order and appear on all articles in the path
- All CSS uses existing design tokens (custom properties) for consistency
</success_criteria>

<output>
After completion, create `.planning/phases/05-navigation-information-architecture/05-03-SUMMARY.md`
</output>
