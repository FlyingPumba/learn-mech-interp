---
phase: 05-navigation-information-architecture
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - eleventy.config.js
  - src/_data/learningPath.json
  - src/topics/topics.11tydata.js
autonomous: true

must_haves:
  truths:
    - "Eleventy builds successfully with navigation, TOC, and ID attribute plugins registered"
    - "A learningPath collection exists containing all topic articles sorted by the learning path order"
    - "Each topic article has eleventyNavigation computed data with key, parent, and order"
  artifacts:
    - path: "src/_data/learningPath.json"
      provides: "Ordered learning path data with blocks and topics"
      contains: "blocks"
    - path: "eleventy.config.js"
      provides: "Plugin registrations and learningPath collection"
      contains: "eleventyNavigationPlugin"
    - path: "src/topics/topics.11tydata.js"
      provides: "Computed eleventyNavigation data for all topic articles"
      contains: "eleventyNavigation"
  key_links:
    - from: "src/topics/topics.11tydata.js"
      to: "src/_data/learningPath.json"
      via: "eleventyComputed reads block from front matter, navigation plugin uses parent key"
      pattern: "eleventyNavigation"
    - from: "eleventy.config.js"
      to: "src/_data/learningPath.json"
      via: "learningPath collection reads data file to determine sort order"
      pattern: "learningPath"
---

<objective>
Install navigation and TOC plugins, create the learning path data file, register all plugins in Eleventy config, create the learningPath collection, and set up computed navigation data for topic articles.

Purpose: This plan lays the data foundation that all subsequent navigation plans depend on -- the plugin infrastructure, the canonical topic ordering, and the computed navigation metadata.
Output: Working Eleventy build with navigation plugin, TOC plugin, IdAttributePlugin, learningPath.json data file, learningPath collection, and computed eleventyNavigation data on all topic articles.
</objective>

<execution_context>
@/Users/ivan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ivan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-navigation-information-architecture/05-RESEARCH.md
@eleventy.config.js
@package.json
@src/topics/topics.11tydata.js
@src/_data/references.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install plugins and create learning path data</name>
  <files>
    package.json
    src/_data/learningPath.json
  </files>
  <action>
    1. Run `npm install @11ty/eleventy-navigation eleventy-plugin-toc` in the project root.

    2. Create `src/_data/learningPath.json` with the following structure. The blocks and topics reflect the 3 existing pilot articles plus the test article (which should NOT be included). The ordering follows the course block structure from PROJECT.md:

    ```json
    {
      "blocks": [
        {
          "slug": "transformer-foundations",
          "title": "Transformer Foundations",
          "topics": [
            { "slug": "attention-mechanism", "title": "The Attention Mechanism" }
          ]
        },
        {
          "slug": "superposition-and-feature-extraction",
          "title": "Superposition & Feature Extraction",
          "topics": [
            { "slug": "superposition", "title": "The Superposition Hypothesis" }
          ]
        },
        {
          "slug": "observation-to-causation",
          "title": "Observation to Causation",
          "topics": [
            { "slug": "activation-patching", "title": "Activation Patching and Causal Interventions" }
          ]
        }
      ]
    }
    ```

    The `slug` values must match the directory names under `src/topics/` exactly (these become `page.fileSlug` in Eleventy). The block slugs must match the `block` field in each article's front matter.
  </action>
  <verify>
    - `npm ls @11ty/eleventy-navigation` shows installed version
    - `npm ls eleventy-plugin-toc` shows installed version
    - `cat src/_data/learningPath.json` shows valid JSON with 3 blocks and 3 topics
  </verify>
  <done>Both plugins installed in package.json. learningPath.json exists with correct block/topic structure matching existing articles.</done>
</task>

<task type="auto">
  <name>Task 2: Register plugins, create collection, and add computed navigation data</name>
  <files>
    eleventy.config.js
    src/topics/topics.11tydata.js
  </files>
  <action>
    1. In `eleventy.config.js`, add these imports at the top (after existing imports):

    ```js
    import { IdAttributePlugin } from "@11ty/eleventy";
    import eleventyNavigationPlugin from "@11ty/eleventy-navigation";
    import pluginTOC from "eleventy-plugin-toc";
    ```

    Note: `eleventy-plugin-toc` is CJS but Node.js ESM can import CJS modules. If the default import fails, use `import { default as pluginTOC } from "eleventy-plugin-toc"` instead.

    2. Inside the default export function, after the existing `addPlugin` calls, register the new plugins:

    ```js
    // Heading ID attributes (required before TOC plugin)
    eleventyConfig.addPlugin(IdAttributePlugin);

    // Navigation plugin for sidebar hierarchy and breadcrumbs
    eleventyConfig.addPlugin(eleventyNavigationPlugin);

    // Table of contents from rendered headings
    eleventyConfig.addPlugin(pluginTOC, {
      tags: ["h2", "h3"],
      wrapper: "",
      wrapperClass: "",
      ul: true
    });
    ```

    3. Add the learningPath collection. Place it after the plugin registrations but before the `return` statement. Use `fs` to read the data file (import `fs` from `node:fs` at the top of the file):

    ```js
    import fs from "node:fs";
    ```

    Then the collection:

    ```js
    // Learning path collection: topics sorted by learningPath.json order
    eleventyConfig.addCollection("learningPath", function(collectionApi) {
      const pathData = JSON.parse(
        fs.readFileSync("src/_data/learningPath.json", "utf-8")
      );
      const order = pathData.blocks.flatMap(b => b.topics.map(t => t.slug));
      const topics = collectionApi.getFilteredByGlob("src/topics/*/index.md");
      return topics
        .filter(item => order.includes(item.fileSlug))
        .sort((a, b) => order.indexOf(a.fileSlug) - order.indexOf(b.fileSlug));
    });
    ```

    The `filter` call excludes the test article (which is not in learningPath.json) from the ordered collection.

    4. Update `src/topics/topics.11tydata.js` to add computed eleventyNavigation data. The current file exports layout and permalink. Add `eleventyComputed` to derive navigation metadata from front matter:

    ```js
    export default {
      layout: "layouts/article.njk",
      permalink: "/topics/{{ page.fileSlug }}/",
      eleventyComputed: {
        eleventyNavigation: (data) => {
          if (!data.title || !data.block) return undefined;
          return {
            key: data.page.fileSlug,
            parent: data.block,
            order: data.order || 0
          };
        }
      }
    };
    ```

    Using `data.page.fileSlug` as the key (not `data.title`) avoids issues with special characters in titles and ensures stable keys. The `parent` uses the `block` field from front matter (e.g., "transformer-foundations"). The guard clause `if (!data.title || !data.block)` prevents the test article (which has no block) from being included in navigation.
  </action>
  <verify>
    - Run `npx @11ty/eleventy --dryrun` and verify it completes without errors
    - Run `npx @11ty/eleventy` and verify the build succeeds
    - Check that built HTML files contain `id` attributes on headings (grep for `id=` in a built article)
  </verify>
  <done>All three plugins registered. learningPath collection defined and filters out test article. Topics have computed eleventyNavigation data derived from front matter. Build succeeds.</done>
</task>

</tasks>

<verification>
1. `npm ls @11ty/eleventy-navigation eleventy-plugin-toc` shows both installed
2. `npx @11ty/eleventy` builds without errors
3. `grep -r "eleventyNavigation" src/topics/topics.11tydata.js` confirms computed data
4. Built article HTML contains heading `id` attributes (IdAttributePlugin working)
5. No regressions in existing article rendering
</verification>

<success_criteria>
- Build completes successfully with all 3 new plugins
- learningPath.json contains 3 blocks with 3 topics matching existing articles
- learningPath collection exists and returns articles in path order
- Topic articles have computed eleventyNavigation metadata
- Existing content (KaTeX, citations, sidenotes, figures) renders correctly
</success_criteria>

<output>
After completion, create `.planning/phases/05-navigation-information-architecture/05-01-SUMMARY.md`
</output>
