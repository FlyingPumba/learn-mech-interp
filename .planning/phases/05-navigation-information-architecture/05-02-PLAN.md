---
phase: 05-navigation-information-architecture
plan: 02
type: execute
wave: 2
depends_on: ["05-01"]
files_modified:
  - src/_includes/partials/header.njk
  - src/_includes/partials/sidebar.njk
  - src/_includes/layouts/base.njk
  - src/css/layout.css
  - src/css/components.css
  - src/js/sidebar-toggle.js
autonomous: true

must_haves:
  truths:
    - "A sidebar on desktop shows the full topic hierarchy grouped by block, with the current page highlighted"
    - "On mobile (< 768px), the sidebar is hidden behind a hamburger button that toggles it open/closed with proper ARIA attributes"
    - "The sidebar toggle button has aria-expanded state and aria-controls pointing to the sidebar element"
    - "Existing article layout (sidenotes, content width, figures) is not broken by the page-level grid change"
  artifacts:
    - path: "src/_includes/partials/sidebar.njk"
      provides: "Sidebar navigation partial with topic hierarchy"
      contains: "eleventyNavigation"
    - path: "src/js/sidebar-toggle.js"
      provides: "Accessible hamburger toggle with ARIA management"
      contains: "aria-expanded"
    - path: "src/_includes/layouts/base.njk"
      provides: "Page-level grid layout with sidebar and main content"
      contains: "sidebar"
  key_links:
    - from: "src/_includes/partials/sidebar.njk"
      to: "eleventy.config.js"
      via: "eleventyNavigation filter from navigation plugin"
      pattern: "eleventyNavigation"
    - from: "src/js/sidebar-toggle.js"
      to: "src/_includes/partials/sidebar.njk"
      via: "DOM ID reference for toggle target"
      pattern: "getElementById.*sidebar"
    - from: "src/_includes/layouts/base.njk"
      to: "src/_includes/partials/sidebar.njk"
      via: "Nunjucks include"
      pattern: "include.*sidebar"
---

<objective>
Create the sidebar navigation showing the full topic hierarchy, add a hamburger menu toggle for mobile, and restructure the page layout to accommodate the sidebar alongside main content.

Purpose: Users can see where they are in the topic structure and navigate to any topic from any page. Mobile users get a clean hamburger toggle instead of a permanent sidebar.
Output: Working sidebar with topic hierarchy, mobile hamburger toggle with ARIA, and page-level grid layout.
</objective>

<execution_context>
@/Users/ivan/.claude/get-shit-done/workflows/execute-plan.md
@/Users/ivan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-navigation-information-architecture/05-RESEARCH.md
@.planning/phases/05-navigation-information-architecture/05-01-SUMMARY.md
@src/_includes/layouts/base.njk
@src/_includes/partials/header.njk
@src/css/layout.css
@src/css/components.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create sidebar partial, update header with hamburger toggle, restructure base layout</name>
  <files>
    src/_includes/partials/sidebar.njk
    src/_includes/partials/header.njk
    src/_includes/layouts/base.njk
    src/js/sidebar-toggle.js
  </files>
  <action>
    1. Create `src/_includes/partials/sidebar.njk` with the navigation hierarchy. The navigation plugin needs parent keys to exist. Since blocks are not pages, we need to handle the hierarchy manually using the learningPath data instead of relying on the navigation plugin's tree. Use `learningPath` global data (from `_data/learningPath.json`) to build the sidebar:

    ```nunjucks
    <nav id="sidebar" class="sidebar" aria-label="Topics">
      <div class="sidebar-inner">
        <h2 class="sidebar-title">Topics</h2>
        {% for block in learningPath.blocks %}
        <div class="sidebar-block">
          <h3 class="sidebar-block-title">{{ block.title }}</h3>
          <ul class="sidebar-topics">
            {% for topic in block.topics %}
            <li>
              <a href="/topics/{{ topic.slug }}/"{% if page.fileSlug == topic.slug %} aria-current="page" class="sidebar-active"{% endif %}>
                {{ topic.title }}
              </a>
            </li>
            {% endfor %}
          </ul>
        </div>
        {% endfor %}
      </div>
    </nav>
    ```

    This approach uses learningPath.json directly (available as `learningPath` global data) instead of the navigation plugin's `eleventyNavigation` filter. This avoids the pitfall of needing parent key pages for blocks. The navigation plugin will still be used for breadcrumbs in Plan 03.

    2. Update `src/_includes/partials/header.njk` to add the hamburger toggle button. Add it before the nav-links, inside the site-nav:

    ```nunjucks
    <header class="site-header">
      <nav class="site-nav" aria-label="Main navigation">
        <a href="/" class="site-logo">Learn MI</a>
        <ul class="nav-links">
          <li><a href="/topics/">Topics</a></li>
        </ul>
        <button class="sidebar-toggle" aria-expanded="false" aria-controls="sidebar" aria-label="Toggle navigation menu" hidden>
          <span class="hamburger-icon" aria-hidden="true"></span>
        </button>
      </nav>
    </header>
    ```

    The `hidden` attribute ensures the button is invisible when JS is not available (progressive enhancement). The JS will remove `hidden` on load.

    3. Update `src/_includes/layouts/base.njk` to include the sidebar and wrap content in a page-level grid container. The sidebar should be a sibling of `<main>`, not inside it:

    ```nunjucks
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>{% if title %}{{ title }} | {% endif %}Learn Mechanistic Interpretability</title>
      <meta name="description" content="{{ description | default('Learn Mechanistic Interpretability through structured articles covering transformer internals to frontier research.') }}">
      <link rel="stylesheet" href="/css/variables.css">
      <link rel="stylesheet" href="/css/base.css">
      <link rel="stylesheet" href="/css/layout.css">
      <link rel="stylesheet" href="/css/components.css">
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.28/dist/katex.min.css">
      <link rel="stylesheet" href="/css/katex-overrides.css">
      <link rel="stylesheet" href="/css/prism-theme.css">
    </head>
    <body>
      {% include "partials/header.njk" %}
      <div class="page-layout">
        {% include "partials/sidebar.njk" %}
        <main>
          {{ content | safe }}
        </main>
      </div>
      {% include "partials/footer.njk" %}
      <script src="/js/sidebar-toggle.js"></script>
    </body>
    </html>
    ```

    The `page-layout` div wraps the sidebar and main content for CSS Grid on desktop.

    4. Create `src/js/sidebar-toggle.js` with accessible toggle logic (~15 lines):

    ```js
    // Sidebar toggle for mobile navigation
    // Progressive enhancement: button is hidden by default, shown when JS loads
    (function() {
      var toggle = document.querySelector('.sidebar-toggle');
      var sidebar = document.getElementById('sidebar');
      if (!toggle || !sidebar) return;

      toggle.hidden = false;

      toggle.addEventListener('click', function() {
        var expanded = toggle.getAttribute('aria-expanded') === 'true';
        toggle.setAttribute('aria-expanded', String(!expanded));
        sidebar.classList.toggle('sidebar-open');
      });

      // Close sidebar when clicking outside on mobile
      document.addEventListener('click', function(e) {
        if (!sidebar.contains(e.target) && !toggle.contains(e.target) && sidebar.classList.contains('sidebar-open')) {
          toggle.setAttribute('aria-expanded', 'false');
          sidebar.classList.remove('sidebar-open');
        }
      });
    })();
    ```

    5. Add `src/js` to passthrough copy in `eleventy.config.js`. Add this line after the existing `addPassthroughCopy` calls:

    ```js
    eleventyConfig.addPassthroughCopy("src/js");
    ```

    Wait -- this file is owned by Plan 01. Since Plan 01 will have already run, and this is a single-line addition that does not conflict, add it to `eleventy.config.js` as part of this task. Just add it after the existing passthrough copies.
  </action>
  <verify>
    - `npx @11ty/eleventy` builds without errors
    - Built `_site/js/sidebar-toggle.js` exists
    - Built HTML pages contain the sidebar nav element with topic links
    - Built HTML pages contain the hamburger button with aria-expanded
  </verify>
  <done>Sidebar partial renders topic hierarchy from learningPath data. Hamburger toggle button is in header with proper ARIA. Base layout wraps sidebar and main in page-layout grid container. JS toggle file is created and passthrough copied.</done>
</task>

<task type="auto">
  <name>Task 2: CSS for sidebar layout, mobile hamburger, and page grid</name>
  <files>
    src/css/layout.css
    src/css/components.css
  </files>
  <action>
    1. In `src/css/layout.css`, add the page-level grid layout. Add this BEFORE the existing `@media (min-width: 1400px)` block (which handles the article-level grid for sidenotes):

    ```css
    /* Page-level grid: sidebar + main content (desktop only) */
    @media (min-width: 1200px) {
      .page-layout {
        display: grid;
        grid-template-columns: 240px 1fr;
        max-width: 1400px;
        margin: 0 auto;
      }
    }
    ```

    The page-level grid (sidebar + main) is independent of the article-level grid (content + sidenotes) defined at 1400px+. The article grid lives inside the `main` column. No changes needed to the existing 1400px+ article grid -- it operates within its grid cell.

    2. In `src/css/components.css`, add sidebar styles at the end of the file (before any @media blocks if there's a logical place, or at the very end). Add these sections:

    **Sidebar styles:**

    ```css
    /* ==========================================================================
       SIDEBAR NAVIGATION
       Topic hierarchy sidebar with block groupings.
       Desktop: always visible in left column. Mobile: hidden, toggled by hamburger.
       ========================================================================== */

    .sidebar {
      padding: var(--spacing-lg, 1.5rem);
      border-right: 1px solid var(--color-border, rgba(0, 0, 0, 0.08));
      background: var(--color-background, #ffffff);
    }

    .sidebar-inner {
      position: sticky;
      top: var(--spacing-lg, 1.5rem);
    }

    .sidebar-title {
      font-size: var(--font-size-small, 0.875rem);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--color-text-muted, rgba(0, 0, 0, 0.4));
      margin: 0 0 var(--spacing-md, 1rem) 0;
    }

    .sidebar-block {
      margin-bottom: var(--spacing-lg, 1.5rem);
    }

    .sidebar-block-title {
      font-size: var(--font-size-small, 0.875rem);
      font-weight: 600;
      color: var(--color-text, rgba(0, 0, 0, 0.87));
      margin: 0 0 var(--spacing-sm, 0.5rem) 0;
    }

    .sidebar-topics {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    .sidebar-topics li {
      margin-bottom: 0.125rem;
    }

    .sidebar-topics a {
      display: block;
      padding: 0.25rem 0.5rem;
      font-size: var(--font-size-small, 0.875rem);
      color: var(--color-text-secondary, rgba(0, 0, 0, 0.6));
      text-decoration: none;
      border-radius: var(--radius-sm, 3px);
      transition: all var(--transition-fast, 150ms ease);
    }

    .sidebar-topics a:hover {
      color: var(--color-link, #004276);
      background: rgba(0, 66, 118, 0.04);
    }

    .sidebar-topics a.sidebar-active,
    .sidebar-topics a[aria-current="page"] {
      color: var(--color-link, #004276);
      background: rgba(0, 66, 118, 0.08);
      font-weight: 600;
    }
    ```

    **Hamburger button styles:**

    ```css
    /* ==========================================================================
       HAMBURGER TOGGLE (Mobile)
       Shows/hides sidebar on small screens. Hidden on desktop via CSS.
       ========================================================================== */

    .sidebar-toggle {
      display: none;
      background: none;
      border: none;
      padding: var(--spacing-sm, 0.5rem);
      cursor: pointer;
    }

    .hamburger-icon {
      display: block;
      width: 20px;
      height: 2px;
      background: var(--color-text, rgba(0, 0, 0, 0.87));
      position: relative;
    }

    .hamburger-icon::before,
    .hamburger-icon::after {
      content: "";
      display: block;
      width: 20px;
      height: 2px;
      background: var(--color-text, rgba(0, 0, 0, 0.87));
      position: absolute;
      left: 0;
    }

    .hamburger-icon::before {
      top: -6px;
    }

    .hamburger-icon::after {
      top: 6px;
    }
    ```

    **Mobile sidebar styles:**

    ```css
    /* Mobile: sidebar hidden, slides in from left when toggled */
    @media (max-width: 1199px) {
      .sidebar-toggle {
        display: block;
      }

      .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 280px;
        height: 100vh;
        z-index: 50;
        overflow-y: auto;
        transform: translateX(-100%);
        transition: transform 0.3s ease;
        border-right: 1px solid var(--color-border, rgba(0, 0, 0, 0.1));
        box-shadow: none;
      }

      .sidebar.sidebar-open {
        transform: translateX(0);
        box-shadow: 4px 0 12px rgba(0, 0, 0, 0.1);
      }
    }
    ```

    IMPORTANT: Do NOT modify the existing `@media (min-width: 1400px)` block in layout.css that handles the article grid for sidenotes. The page-level grid and article-level grid are independent. The article grid operates within the `main` column of the page grid.
  </action>
  <verify>
    - `npx @11ty/eleventy` builds without errors
    - Open a built article HTML and confirm both the page-layout div and sidebar nav are present
    - Verify the 1400px+ article grid CSS for sidenotes is unchanged in layout.css
    - Verify sidebar CSS includes `.sidebar-active` and `aria-current` styling
  </verify>
  <done>Page-level grid layout places sidebar next to main content on desktop (1200px+). Sidebar is styled with topic hierarchy, active page highlighting, and block groupings. Mobile sidebar slides in from left with hamburger toggle. Existing article sidenote layout at 1400px+ is preserved.</done>
</task>

</tasks>

<verification>
1. `npx @11ty/eleventy` builds successfully
2. Built article pages show sidebar with 3 blocks and 3 topics
3. Current page is highlighted in sidebar (aria-current="page" present)
4. Hamburger button exists in header with aria-expanded="false" and hidden attribute
5. sidebar-toggle.js is in _site/js/
6. Page-level grid at 1200px+ creates sidebar + main columns
7. Mobile sidebar is off-screen by default (transform: translateX(-100%))
8. Existing sidenote/marginnote float layout at 1400px+ is not modified
</verification>

<success_criteria>
- Sidebar displays full topic hierarchy grouped by blocks
- Current page is visually highlighted in sidebar
- Hamburger button toggles sidebar visibility on mobile with ARIA state management
- Desktop layout shows sidebar alongside content without breaking existing article grid
- No regression in sidenote/marginnote rendering on wide screens
</success_criteria>

<output>
After completion, create `.planning/phases/05-navigation-information-architecture/05-02-SUMMARY.md`
</output>
